<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>UniManage Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
/* --- Global Styles --- */
* { box-sizing:border-box; margin:0; padding:0; font-family: 'Segoe UI', sans-serif;}
body { background:#f0f4f8; color:#333; transition:0.3s;}
.header{ display:flex; justify-content:space-between; align-items:center; padding:12px 25px; background:#0077b6; color:white; position:fixed; width:100%; top:0; z-index:10;}
.header h1{ display:flex; align-items:center; gap:8px; }
.header button{ margin-left:10px; background:none; border:none; color:white; cursor:pointer; padding:8px;}
.sidebar{ position:fixed; top:60px; left:0; width:220px; height:100%; background:#023e8a; padding-top:20px; color:white;}
.sidebar ul{ list-style:none; }
.sidebar li{ padding:15px 20px; cursor:pointer; display:flex; align-items:center; gap:12px; border-radius:6px; margin:5px 10px; transition:0.2s; }
.sidebar li:hover{ background:#0077b6; transform:translateX(5px);}
main{ margin-left:240px; padding:80px 30px 30px 30px;}
h2,h3{ margin-bottom:15px;}
.cards{ display:flex; gap:20px; flex-wrap:wrap; margin-bottom:40px; }
.card{ background:#90e0ef; flex:1; min-width:180px; padding:25px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); text-align:center; transition:0.3s;}
.card:hover{ transform:translateY(-5px); box-shadow:0 8px 15px rgba(0,0,0,0.2);}
section{ margin-bottom:50px; background:#fff; padding:20px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
table{ width:100%; border-collapse:collapse; margin-top:10px; }
th,td{ border:1px solid #ccc; padding:10px; text-align:left;}
th{ background:#0077b6; color:white;}
tr:nth-child(even){ background:#f2f2f2;}
tr:hover{ background:#d0e7ff;}
input,select,button,textarea{ padding:8px; border-radius:6px; border:1px solid #ccc; margin-right:10px; }
button{ background:#0077b6; color:white; cursor:pointer; border:none; transition:0.2s;}
button:hover{ background:#023e8a;}
.modal{ display:none; position:fixed; z-index:100; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.5);}
.modal-content{ background:#fff; margin:10% auto; padding:25px; border-radius:12px; width:350px; position:relative;}
.closeBtn{ position:absolute; top:10px; right:15px; cursor:pointer; font-size:22px; color:#333;}
.closeBtn:hover{ color:#0077b6;}
body.dark{ background:#121212; color:#fff; }
body.dark .header{ background:#1c1c1c; }
body.dark .sidebar{ background:#1c1c1c;}
body.dark section, body.dark .card{ background:#1a1a1a; color:white; box-shadow:0 4px 12px rgba(255,255,255,0.05);}
body.dark table, body.dark th, body.dark td{ border-color:#555;}
body.dark th{ background:#0077b6; color:white;}
body.dark input, body.dark select, body.dark textarea{ background:#121212; border-color:#555; color:#fff;}
body.dark button{ background:#0077b6; color:white;}
body.dark .modal-content{ background:#1a1a1a; color:#fff;}
</style>
</head>
<body>

<!-- Header -->
<header class="header">
<h1><i class="fa-solid fa-graduation-cap"></i> UniManage</h1>
<div>
<button id="darkModeToggle"><i class="fa-solid fa-moon"></i></button>
<button id="openLogin">Login</button>
<button id="openRegister">Register</button>
</div>
</header>

<!-- Sidebar -->
<aside class="sidebar">
<ul>
<li onclick="scrollToSection('dashboard')"><i class="fa-solid fa-house"></i> Dashboard</li>
<li onclick="scrollToSection('notes')"><i class="fa-solid fa-book"></i> Notes</li>
<li onclick="scrollToSection('pyq')"><i class="fa-solid fa-file"></i> PYQs</li>
<li onclick="scrollToSection('solutions')"><i class="fa-solid fa-circle-check"></i> Solutions</li>
<li onclick="scrollToSection('faculty')"><i class="fa-solid fa-user"></i> Faculty</li>
<li onclick="scrollToSection('students')"><i class="fa-solid fa-users"></i> Students & CR</li>
<li onclick="scrollToSection('notices')"><i class="fa-solid fa-bullhorn"></i> Notices</li>
<li onclick="scrollToSection('routine')"><i class="fa-solid fa-calendar-days"></i> Routine</li>
<li onclick="scrollToSection('bus')"><i class="fa-solid fa-bus"></i> Bus Schedule</li>
<li onclick="scrollToSection('alumni')"><i class="fa-solid fa-award"></i> Alumni</li>
<li onclick="scrollToSection('cgpa')"><i class="fa-solid fa-calculator"></i> CGPA Calculator</li>
<li onclick="scrollToSection('feedback')"><i class="fa-solid fa-comment"></i> Feedback</li>
</ul>
</aside>

<main>

<!-- 1. Dashboard -->
<section id="dashboard">
<h2>Dashboard</h2>
<div class="cards">
<div class="card"><h3>Total Notes</h3><p id="totalNotes">0</p></div>
<div class="card"><h3>Total Faculty</h3><p id="totalFaculty">0</p></div>
<div class="card"><h3>Total Students</h3><p id="totalStudents">0</p></div>
<div class="card"><h3>Total PYQs</h3><p id="totalPYQ">0</p></div>
</div>
</section>

<!-- 2. Notes -->
<section id="notes">
<h2>Academic Notes</h2>
<table id="notesTable"><tr><th>Course</th><th>Title</th><th>Download</th></tr></table>
</section>

<!-- 3. PYQs -->
<section id="pyq">
<h2>Previous Year Questions</h2>
<table id="pyqTable"><tr><th>Year</th><th>Semester</th><th>Download</th></tr></table>
</section>

<!-- 4. Solutions -->
<section id="solutions">
<h2>Solutions</h2>
<table id="solutionsTable"><tr><th>PYQ</th><th>Solution</th></tr></table>
</section>

<!-- 5. Faculty -->
<section id="faculty">
<h2>Faculty & Supervisors</h2>
<table id="facultyTable"><tr><th>Name</th><th>Designation</th><th>Email</th><th>Phone</th></tr></table>
</section>

<!-- 6. Students -->
<section id="students">
<h2>Students & Class Representatives</h2>
<table id="studentsTable"><tr><th>Name</th><th>Batch</th><th>Role</th></tr></table>
</section>

<!-- 7. Notices -->
<section id="notices">
<h2>Notices & Announcements</h2>
<ul id="noticesList"></ul>
</section>

<!-- 8. Routine -->
<section id="routine">
<h2>Class & Lab Routine</h2>
<table id="routineTable"><tr><th>Day</th><th>Time</th><th>Class / Lab</th></tr></table>
</section>

<!-- 9. Bus Schedule -->
<section id="bus">
<h2>University Bus Schedule</h2>
<table id="busTable"><tr><th>Route</th><th>Time</th><th>Pickup</th><th>Drop</th></tr></table>
</section>

<!-- 10. Alumni -->
<section id="alumni">
<h2>Proud Alumni</h2>
<div id="alumniCards" style="display:flex;flex-wrap:wrap;gap:15px;"></div>
</section>

<!-- 11. CGPA -->
<section id="cgpa">
<h2>CGPA & Grade Calculator</h2>
<input type="number" id="cgpaInput" placeholder="Enter GPA" step="0.01">
<button onclick="addGPA()">Add</button>
<p id="cgpaResult"></p>
</section>

<!-- 12. Feedback -->
<section id="feedback">
<h2>Feedback / Help Desk</h2>
<form id="feedbackForm">
<input type="text" placeholder="Your Name" required>
<input type="email" placeholder="Your Email" required>
<textarea placeholder="Your Feedback" required></textarea>
<button type="submit">Submit</button>
</form>
</section>

</main>

<!-- Login Modal -->
<div id="loginModal" class="modal">
<div class="modal-content">
<span class="closeBtn" onclick="closeModal('loginModal')">&times;</span>
<h2>Login</h2>
<form id="loginForm">
<input type="email" placeholder="Email" required><br><br>
<input type="password" placeholder="Password" required><br><br>
<button type="submit">Login</button>
</form>
</div>
</div>

<!-- Register Modal -->
<div id="registerModal" class="modal">
<div class="modal-content">
<span class="closeBtn" onclick="closeModal('registerModal')">&times;</span>
<h2>Register</h2>
<form id="registerForm">
<input type="text" placeholder="Full Name" required><br><br>
<input type="email" placeholder="Email" required><br><br>
<input type="password" placeholder="Password" required><br><br>
<select required>
<option value="">Select Role</option>
<option value="admin">Admin</option>
<option value="student">Student</option>
</select><br><br>
<button type="submit">Register</button>
</form>
</div>
</div>

<script>
/* --- Dark Mode --- */
document.getElementById('darkModeToggle').addEventListener('click', ()=>document.body.classList.toggle('dark'));

/* --- Scroll to section --- */
function scrollToSection(id){ document.getElementById(id).scrollIntoView({behavior:'smooth'}); }

/* --- Modal open/close --- */
document.getElementById('openLogin').addEventListener('click',()=>document.getElementById('loginModal').style.display='block');
document.getElementById('openRegister').addEventListener('click',()=>document.getElementById('registerModal').style.display='block');
function closeModal(id){ document.getElementById(id).style.display='none'; }
window.onclick = function(e){ if(e.target.classList.contains('modal')) e.target.style.display='none'; }

/* --- Login/Register --- */
document.getElementById('loginForm').addEventListener('submit', async e=>{
    e.preventDefault();
    const email=e.target[0].value,password=e.target[1].value;
    const res=await fetch('http://localhost:5000/api/auth/login',{
        method:'POST', headers:{'Content-Type':'application/json'},
        body:JSON.stringify({email,password})
    });
    const data=await res.json();
    alert(data.message);
    closeModal('loginModal');
});

document.getElementById('registerForm').addEventListener('submit', async e=>{
    e.preventDefault();
    const name=e.target[0].value,email=e.target[1].value,password=e.target[2].value,role=e.target[3].value;
    const res=await fetch('http://localhost:5000/api/auth/register',{
        method:'POST', headers:{'Content-Type':'application/json'},
        body:JSON.stringify({name,email,password,role})
    });
    const data=await res.json();
    alert(data.message);
    closeModal('registerModal');
});

/* --- Feedback --- */
document.getElementById('feedbackForm').addEventListener('submit', async e=>{
    e.preventDefault();
    const name=e.target[0].value,email=e.target[1].value,message=e.target[2].value;
    await fetch('http://localhost:5000/api/feedback',{
        method:'POST', headers:{'Content-Type':'application/json'},
        body:JSON.stringify({name,email,message})
    });
    alert('Feedback submitted successfully!');
    e.target.reset();
});

/* --- CGPA Calculator --- */
let gpaList=[];
function addGPA(){
    const gpa=parseFloat(document.getElementById('cgpaInput').value);
    if(!isNaN(gpa)){ gpaList.push(gpa); }
    const sum=gpaList.reduce((a,b)=>a+b,0);
    const avg=(sum/gpaList.length).toFixed(2);
    document.getElementById('cgpaResult').innerText=`Current CGPA: ${avg}`;
    document.getElementById('cgpaInput').value='';
}

/* --- Load data from backend --- */
async function loadData(){
    // Notes
    const notes=await fetch('http://localhost:5000/api/notes').then(r=>r.json());
    const notesTable=document.getElementById('notesTable');
    notes.forEach(n=>{ const row=notesTable.insertRow(); row.innerHTML=`<td>${n.course}</td><td>${n.title}</td><td><a href="http://localhost:5000/uploads/${n.file}" target="_blank"><button>Download</button></a></td>`; });
    document.getElementById('totalNotes').innerText=notes.length;

    // PYQs
    const pyqs=await fetch('http://localhost:5000/api/pyqs').then(r=>r.json());
    const pyqTable=document.getElementById('pyqTable');
    pyqs.forEach(p=>{ const row=pyqTable.insertRow(); row.innerHTML=`<td>${p.year}</td><td>${p.semester}</td><td><a href="http://localhost:5000/uploads/${p.file}" target="_blank"><button>Download</button></a></td>`; });
    document.getElementById('totalPYQ').innerText=pyqs.length;

    // Solutions
    const solutions=await fetch('http://localhost:5000/api/solutions').then(r=>r.json());
    const solTable=document.getElementById('solutionsTable');
    solutions.forEach(s=>{ const row=solTable.insertRow(); row.innerHTML=`<td>${s.pyq}</td><td><a href="http://localhost:5000/uploads/${s.file}" target="_blank"><button>View</button></a></td>`; });

    // Faculty
    const faculty=await fetch('http://localhost:5000/api/faculty').then(r=>r.json());
    const facTable=document.getElementById('facultyTable');
    faculty.forEach(f=>{ const row=facTable.insertRow(); row.innerHTML=`<td>${f.name}</td><td>${f.designation}</td><td>${f.email}</td><td>${f.phone}</td>`; });
    document.getElementById('totalFaculty').innerText=faculty.length;

    // Students
    const students=await fetch('http://localhost:5000/api/students').then(r=>r.json());
    const stuTable=document.getElementById('studentsTable');
    students.forEach(s=>{ const row=stuTable.insertRow(); row.innerHTML=`<td>${s.name}</td><td>${s.batch}</td><td>${s.role}</td>`; });
    document.getElementById('totalStudents').innerText=students.length;

    // Notices
    const notices=await fetch('http://localhost:5000/api/notices').then(r=>r.json());
    const noticesList=document.getElementById('noticesList');
    notices.forEach(n=>{ const li=document.createElement('li'); li.innerText=n.text; noticesList.appendChild(li); });

    // Routine
    const routines=await fetch('http://localhost:5000/api/routines').then(r=>r.json());
    const routineTable=document.getElementById('routineTable');
    routines.forEach(rn=>{ const row=routineTable.insertRow(); row.innerHTML=`<td>${rn.day}</td><td>${rn.time}</td><td>${rn.classLab}</td>`; });

    // Bus
    const buses=await fetch('http://localhost:5000/api/bus').then(r=>r.json());
    const busTable=document.getElementById('busTable');
    buses.forEach(b=>{ const row=busTable.insertRow(); row.innerHTML=`<td>${b.route}</td><td>${b.time}</td><td>${b.pickup}</td><td>${b.drop}</td>`; });

    // Alumni
    const alumni=await fetch('http://localhost:5000/api/alumni').then(r=>r.json());
    const alumniDiv=document.getElementById('alumniCards');
    alumni.forEach(a=>{ const card=document.createElement('div'); card.style.width='200px'; card.style.border='1px solid #ccc'; card.style.padding='10px'; card.style.borderRadius='8px';
    card.innerHTML=`<img src="http://localhost:5000/uploads/${a.photo}" width="100%" /><h4>${a.name}</h4><p>${a.achievements}</p>`; alumniDiv.appendChild(card); });
}
loadData();
</script>
</body>
</html>
